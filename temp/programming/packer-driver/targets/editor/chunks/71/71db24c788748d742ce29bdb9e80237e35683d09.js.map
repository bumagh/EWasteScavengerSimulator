{"version":3,"sources":["file:///D:/2work/2GameDev/EWasteScavengerSimulatorCocos2d/assets/Game/scripts-001/test-list/BackButton.ts"],"names":["_decorator","Component","director","game","Vec3","Layout","ScrollView","v2","sceneArray","ccclass","property","BackButton","offset","_offset","value","saveOffset","_scrollNode","_scrollCom","getScrollOffset","y","saveIndex","index","_sceneIndex","refreshButton","_prevNode","active","_nextNode","__preload","sceneInfo","_sceneInfos","firstIndex","lastIndex","sceneString","i","length","url","lastIndexOf","substring","push","start","addPersistRootNode","node","getParent","getChildByPath","getComponent","_blockInput","getChildByName","backToList","loadScene","_content","updateLayout","scrollToOffset","x","nextscene","updateSceneIndex","getSceneName","prescene","next"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, director, game, Node, Vec3, Layout, ScrollView, v2 } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { sceneArray } from './SceneList';\n\n@ccclass('BackButton')\nexport class BackButton extends Component {\n\n    public static get offset () {\n        return BackButton._offset;\n    }\n\n    public static set offset ( value ) {\n        BackButton._offset = value;\n    }\n    public static _scrollNode: Node | null  = null;\n\n    public static saveOffset () {\n        if ( BackButton._scrollNode ) {\n            BackButton._offset = new Vec3(0, BackButton._scrollCom!.getScrollOffset().y, 0);\n        }\n    }\n\n    public static saveIndex ( index: number) {\n        BackButton._sceneIndex = index;\n        BackButton.refreshButton();\n    }\n\n    public static refreshButton () {\n        if (BackButton._sceneIndex === -1) {\n            BackButton._prevNode.active = false;\n            BackButton._nextNode.active = false;\n        } else {\n            BackButton._prevNode.active = true;\n            BackButton._nextNode.active = true;\n        }\n    }\n    private static _offset = new Vec3();\n    private static _scrollCom: ScrollView | null = null;\n\n    private static _sceneIndex: number = -1;\n    private static _blockInput : Node;\n    private static _prevNode: Node;\n    private static _nextNode: Node;\n\n    public __preload () {\n        // @ts-ignore\n        const sceneInfo = game._sceneInfos;\n        let firstIndex = 0;\n        let lastIndex = 0;\n        let sceneString: string = '';\n        for (let i = 0; i < sceneInfo.length; i++){\n            sceneString = sceneInfo[i].url;\n            firstIndex = sceneString.lastIndexOf('/') + 1;\n            lastIndex = sceneString.lastIndexOf('.scene');\n            sceneString = sceneString.substring(firstIndex, lastIndex);\n            if (sceneString === 'test-list') {\n                continue;\n            }\n            sceneArray.push(sceneString);\n        }\n    }\n\n    public start () {\n        game.addPersistRootNode(this.node);\n        BackButton._scrollNode = this.node.getParent()!.getChildByPath('Canvas/ScrollView') as Node;\n        if (BackButton._scrollNode) {\n            BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollView);\n        }\n        BackButton._blockInput = this.node.getChildByName('BlockInput') as Node;\n        BackButton._blockInput.active = false;\n        BackButton._prevNode = this.node.getChildByName('PrevButton') as Node;\n        BackButton._nextNode = this.node.getChildByName('NextButton') as Node;\n        if (BackButton._prevNode && BackButton._nextNode) {\n            BackButton.refreshButton();\n        }\n    }\n\n    public backToList () {\n        BackButton._blockInput.active = true;\n        director.loadScene('test-list', () => {\n            BackButton._sceneIndex = -1;\n            BackButton.refreshButton();\n            BackButton._scrollNode = this.node.getParent()!.getChildByPath('Canvas/ScrollView') as Node;\n            if (BackButton._scrollNode) {\n                BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollView);\n                // @ts-ignore\n                BackButton._scrollCom._content.getComponent(Layout).updateLayout();                \n                BackButton._scrollCom!.scrollToOffset(v2(BackButton.offset.x, BackButton.offset.y), 0.1, true);\n            }\n            BackButton._blockInput.active = false;\n        });\n    }\n\n    public nextscene () {\n        BackButton._blockInput.active = true;\n        this.updateSceneIndex(true);\n        director.loadScene(this.getSceneName(), () => {\n            BackButton._blockInput.active = false;\n        });\n    }\n\n    public prescene () {\n        BackButton._blockInput.active = true;\n        this.updateSceneIndex(false);\n        director.loadScene(this.getSceneName(), () => {\n            BackButton._blockInput.active = false;\n        });\n    }\n\n    public updateSceneIndex (next: Boolean) {\n        if (next) {\n            (BackButton._sceneIndex + 1) >= sceneArray.length ? BackButton._sceneIndex = 0 : BackButton._sceneIndex += 1;\n        }else {\n            (BackButton._sceneIndex - 1) < 0 ? BackButton._sceneIndex = sceneArray.length - 1 : BackButton._sceneIndex -= 1;\n        }\n    }\n\n    public getSceneName () {\n        return sceneArray[BackButton._sceneIndex];\n    }\n}\n"]}